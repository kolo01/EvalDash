{% extends 'template.html.twig' %}

{% block title %}New Commande
{% endblock %}

{% macro produitMacro(form) %}

	<table class="table " id="lignes">
		<tr>
			<th class="col-md-1">Produit</th>
			<th class="col-md-1">Prix Unitaire</th>
			<th class="col-md-1">Quantité</th>
			{# <th class="col-md-1">Tva</th> #}
			<th class="col-md-1">Total</th>
			<th class="col-md-1">Action</th>
		</tr>
		<tr>
			<td>{{ form_widget(form.Produit) }}</td>
			<td>{{ form_widget(form.quantite) }}</td>
			<td>{{ form_widget(form.PrixVente) }}</td>
			<td>{{0 }}</td>
			<td>
				<button class="delete btn btn-danger w-4">
					Supprimer Produit
				</button>
			</td>

		</tr>

	</table>


{% endmacro produitMacro %}


{% import _self as produit %}


{% block body %}

	{{ form_start(form) }}

	<div class="container">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<i class="icon_menu"></i>Gestion Commande
			</div>

			<div class="panel-body">
				{% if message %}
					{{message}}
				{% endif %}
				<table class="table-condensed">
					<tr>
						<td>Numéro commande :
						</td>
						<td>{{ numc}}</td>
						<td>Date Commande :
						</td>
						<td>{{ form_widget(form.dateCom) }}</td>
						<td>Total :
						</td>
						<td>{{ form_widget(form.total) }}</td>
					</tr>
					<tr>
						<td>Client  :
						</td>
						<td>{{ form_widget(form.Client) }}</td>
					</tr>
					<tr>
						<td>Observation :
						</td>
						<td>{{ form_widget(form.observation) }}</td>
					</tr>
				</table>
				<button type="button" class="ajout btn btn-outline-dark btn-info mb-4" data-collection-holder-class="ligne">Ajouter Ligne De Commande</button>


				<div
					class="ligne " data-index="{{ form.ligneCommandes|length > 0 ? form.ligneCommandes|last.vars.name + 1 : 0 }}" data-prototype="{{produit.produitMacro(form.ligneCommandes.vars.prototype)|e('html_attr') }}">{# {% for ligne in form.ligneCommandes %}
																			<td>{{form_row(ligne.Produit)}}</td>
												<td>{{form_row(ligne.PrixVente)}}</td>
																				<td>{{form_row(ligne.quantite)}}</td>
												
																			
																		{% endfor %} #}
				</div>

				{# </table> #}
				{# the data-index attribute is required for the JavaScript code below #}

				{# <table class ="table  table-condensed">
																        <thead class="thead-dark">
																            <tr>
																            <th>Ligne</th>
																                <th class="col-md-2">Désignation Article</th>
																                <th class="col-md-1">Prix Unitaire</th>
																                <th class="col-md-1">Quantite</th>
																                
																                <th class="col-md-1">Montant Total</th>                
																                <th class="col-md-1">Actions</th>
																            </tr>
																        </thead>
																        <tbody>
																        {% for t in lcomm %}
																             <tr>
																               {# <td class="col-md-2">{{ t.lig}}</td> #}
				{# <td class="col-md-2">{{ t.Produit.libelle}}</td>             
																                <td class="col-md-1">{{ t.quantite }}</td> 
																                <td class="col-md-1">{{ t.PrixVente }}</td> 
																   
																                <td class="col-md-1" >{{ t.quantite * t.PrixVente }}</td> 
																                <td class="col-md-1"><a href="{{ path('supprime_commande', {'id': t.lig}) }}" 
																                 class = "btn btn-danger">
																                <i class = "glyphicon glyphicon-apple"></i>
																                Supprimer</a></td> #}

				{# {% set  tottht = totht + (t.pv * t.qte) %}
																       {% set  totva = totva + (((t.pv * t.qte) * t.tva) *0.01) %} #}
				{# {% set  totttc = totttc + (( (t.pv * t.qte) *( 100 + t.tva)) *0.01) %}            
																        {% endfor %}
																
																        </tbody>
																    </table> #}


				{# <tfoot>
																            <table class = "table table-condensed">
																            <tr>
																                {# <td>Tot Ht :</td>
																                <td class="col-md-2">{{ totht}}</td>
																               
																                <td>Tot Tva :</td>
																                <td class="col-md-2">{{totva }}</td> #}
				{# <td>Tot TTC :</td>
																                <td class ="col-md-2">{{  totttc }}</td>
																             </tr>
																           
																                
																            </table>
																             </tfoot>  #}
					<td>
				<input type="submit" value="Valider" name="bt" class="btn btn-success"/> </td>
			</td>
			{{ form_end(form) }}
			{# <a href="{{ path('app_commande') }}">Retourner</a> #}


			<script>

				jQuery(document).ready(function () { // Get the ul that holds the collection of tags
var $tagsCollectionHolder = $('#lignes');
// count the current form inputs we have (e.g. 2), use that as the new
// index when inserting a new item (e.g. 2)
$tagsCollectionHolder.data('index', $tagsCollectionHolder.find('input').length);

$('body').on('click', '.ajout', function (e) {
var $collectionHolderClass = $(e.currentTarget).data('collectionHolderClass');
// add a new tag form (see next code block)
addFormToCollection($collectionHolderClass);
})
$('body').on('click', '.ajout', function (e) {
var $collectionHolderClass = $(e.currentTarget).data('collectionHolderClass');
// add a new tag form (see next code block)
deleteFormToCollection($collectionHolderClass);
})
});

function addFormToCollection($collectionHolderClass) { // Get the ul that holds the collection of tags
var $collectionHolder = $('.' + $collectionHolderClass);

// Get the data-prototype explained earlier
var prototype = $collectionHolder.data('prototype');

// get the new index
var index = $collectionHolder.data('index');

var newForm = prototype;
// You need this only if you didn't set 'label' => false in your tags field in TaskType
// Replace '__name__label__' in the prototype's HTML to
// instead be a number based on how many items we have
// newForm = newForm.replace(/__name__label__/g, index);

// Replace '__name__' in the prototype's HTML to
// instead be a number based on how many items we have
newForm = newForm.replace(/__name__/g, index);

// increase the index with one for the next item
$collectionHolder.data('index', index + 1);

// Display the form in the page in an li, before the "Add a tag" link li
var $newFormTr = $('<tr></tr>').append(newForm);
// Add the new form at the end of the list
$collectionHolder.append($newFormTr)
}
			</script>
		{% endblock %}
